@{
    ViewBag.Title = "Home";
}
@section featured {    
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">                
            </hgroup>
        </div>
    </section>
}
<h3>Active Features</h3>
<ul class="clean">
        @foreach (var group in ViewBag.Features.Keys)
        {            
            <h3>@group</h3>
            foreach (var feature in ViewBag.Features[group])
            {
                <li>
                    <div>
                        <span class="inlinesparkline">@feature.Sparkline</span>
                        @feature.Name 
                        <a class="edit" href="@feature.Name">[Edit]</a>
                    </div>
                    <div class="featurePanel" id="featurePanel_@(feature.Name)">@feature.Notes</div>
                    <div id="edit_@(feature.Name)" class="editFeature">
                        <label for="group_@(feature.Name)">Group:</label>
                        <input type="text" name="group" id="group_@(feature.Name)" value="@feature.Group"/>
                        <label for="notes_@(feature.Name)">Notes:</label>
                        <textarea id="notes_@(feature.Name)" name="notes">@feature.Notes</textarea>
                        <br/>
                        <button id="close">Close</button>
                        <button id="save">Save</button>
                    </div>                    
                </li>
            }
        }
</ul>


@section scripts {
    <script type="text/javascript">
        $("ul.nav li.dashboard").addClass("active");
        $('.inlinesparkline').sparkline();
        $("a.edit").click(function() {
            var feature = $(this).attr("href");
            $("#featurePanel_" + feature).slideUp();
            $("#edit_" + feature).slideDown();
            $("#edit_" + feature + " button#close").click(function () {                
                $("#edit_" + feature + " button#close").unbind("click");
                $("#edit_" + feature).slideUp();
                $("#featurePanel_" + feature).slideDown();
            });
            $("#edit_" + feature + " button#save").click(function() {                
                $.ajax({
                    type: 'PUT',
                    url: '/api/Feature',
                    data: {
                        id: '',
                        name: feature,
                        group: $("#edit_" + feature + " input[name=group]").val(),
                        notes: $("#edit_" + feature + " textarea[name=notes]").val(),
                        sparkline: ''
                    }
                }).done(function () {                    
                    document.location.href = '/';
                });                
            });
            return false;
        });
    </script>
}